<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Oscars — Nominations (2000–2025)</title>

  <style>
    :root {
      --bg: #0f172a;
      --card: #0b1220;
      --muted: #9aa0b7;
      --accent: #1e81ff;
      --radius: 10px;
    }

    body {
      margin: 0;
      font-family: Inter, Arial, sans-serif;
      background: var(--bg);
      color: white;
    }

    header {
      padding: 24px;
      font-size: 24px;
      border-bottom: 1px solid #1c263b;
    }

    main {
      display: grid;
      grid-template-columns: 250px 1fr 250px;
      gap: 20px;
      padding: 20px;
    }

    aside {
      background: var(--card);
      padding: 16px;
      border-radius: var(--radius);
      height: calc(100vh - 120px);
      overflow-y: auto;
    }

    .year-item {
      padding: 10px;
      margin-bottom: 6px;
      background: #131b2d;
      border-radius: var(--radius);
      cursor: pointer;
    }

    .year-item.active {
      background: var(--accent);
    }

    #results {
      background: var(--card);
      padding: 16px;
      border-radius: var(--radius);
      overflow-y: auto;
      height: calc(100vh - 120px);
    }

    .category {
      margin-bottom: 22px;
      padding-bottom: 12px;
      border-bottom: 1px solid #1c263b;
    }

    .cat-title {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .nominee {
      margin: 4px 0;
      color: var(--muted);
    }

    .winner {
      color: #ffd700;
      font-weight: bold;
    }

    #search {
      width: 100%;
      padding: 10px 14px;
      border-radius: var(--radius);
      border: 1px solid #1c263b;
      background: #131b2d;
      color: white;
      font-size: 16px;
      outline: none;
      margin: 16px 0;
    }

    #status {
      font-size: 14px;
      color: var(--muted);
      padding: 10px;
    }
  </style>
</head>

<body>

<header>
  Oscars — Nominations (2000–2025)
</header>

<main>
  <!-- LEFT SIDEBAR (Year list) -->
  <aside id="yearList"></aside>

  <!-- MIDDLE (Results) -->
  <div>
    <input id="search" placeholder="Filter categories or nominees..." />
    <div id="status">Select a year.</div>
    <div id="results"></div>
  </div>

  <!-- RIGHT INFO BOX -->
  <aside>
    Choose a year to load nominations.
  </aside>
</main>

<script>
/* ------------------ YEAR CONFIG ------------------- */
const YEAR_START = 2000;
const YEAR_END = 2025;

const yearListEl = document.getElementById("yearList");
const resultsEl = document.getElementById("results");
const statusEl = document.getElementById("status");
const searchEl = document.getElementById("search");

/* ------------------ YEAR BUTTONS ------------------ */
for (let y = YEAR_END; y >= YEAR_START; y--) {
  const div = document.createElement("div");
  div.className = "year-item";
  div.textContent = y;
  div.dataset.year = y;
  div.onclick = () => selectYear(y, div);
  yearListEl.appendChild(div);
}

// selectYear using AllOrigins proxy to avoid CORS/HTML error
async function selectYear(year, btn) {
  document.querySelectorAll(".year-item").forEach(x => x.classList.remove("active"));
  if (btn) btn.classList.add("active");

  statusEl.textContent = `Loading ${year}...`;
  resultsEl.innerHTML = "";

  try {
    const ceremonyNum = year - 1928;
    const pageTitle = `${ordinal(ceremonyNum)}_Academy_Awards`;
    // Build the MediaWiki API URL (we will pass it to the CORS proxy)
    const apiUrl = `https://en.wikipedia.org/w/api.php?action=parse&page=${encodeURIComponent(pageTitle)}&prop=text&format=json&formatversion=2`;

    // AllOrigins proxy (returns the raw response and adds CORS headers)
    const proxy = "https://api.allorigins.win/raw?url=";
    const proxied = proxy + encodeURIComponent(apiUrl);

    const res = await fetch(proxied);
    if (!res.ok) throw new Error("Network error from proxy");

    // The proxy returns the *raw* JSON string from MediaWiki (or an HTML error)
    const text = await res.text();

    // Try to parse JSON safely; if it's HTML or invalid JSON we'll show it
    let j;
    try {
      j = JSON.parse(text);
    } catch (e) {
      throw new Error("Server returned non-JSON response (first chars): " + text.slice(0,200));
    }

    if (j.error) throw new Error(j.error.info || JSON.stringify(j.error));

    const html = j.parse && (j.parse.text || j.parse.text['*']) ? (j.parse.text['*'] || j.parse.text) : null;
    if (!html) throw new Error("No HTML content returned from API");

    const data = extractWinners(html);
    data._meta = { year, page: pageTitle, fetchedAt: new Date().toISOString() };

    // render
    statusEl.textContent = `Loaded — ${year}`;
    render(data);

  } catch (err) {
    statusEl.textContent = `Error loading ${year}: ${err.message}`;
    resultsEl.innerHTML = `<pre style="color:#f88">${escapeHtml(String(err.message))}</pre>`;
    console.error(err);
  }
}
function extractWinners(html) {
  const parser = new DOMParser();
  const doc = parser.parseFromString(html, "text/html");

  const headline = 
    doc.querySelector("span.mw-headline[id*='Winners'], h2:contains('Winners')") ||
    doc.querySelector("span.mw-headline[id*='Nominees'], h2:contains('Nominees')");

  if (!headline) return { error: "Winners/Nominees section not found." };

  const section = headline.closest("h2, h3, h4");
  const content = [];
  let next = section.nextElementSibling;

  while (next && !/^H[1-4]$/.test(next.tagName)) {
    if (next.querySelector("li")) {
      next.querySelectorAll("li").forEach(li => {
        content.push(li.textContent.trim());
      });
    }
    next = next.nextElementSibling;
  }

  return {
    categories: [
      {
        category: headline.textContent.trim(),
        nominees: content.map(n => ({ text: n, winner: n.includes("– Winner") }))
      }
    ]
  };
}

/* ------------------ DISPLAY ------------------- */
function render(data) {
  if (data.error) {
    resultsEl.innerHTML = `<div>${data.error}</div>`;
    return;
  }
  resultsEl.innerHTML = "";

  data.categories.forEach(cat => {
    const wrap = document.createElement("div");
    wrap.className = "category";

    wrap.innerHTML = `
      <div class="cat-title">${cat.category}</div>
    `;

    cat.nominees.forEach(n => {
      const d = document.createElement("div");
      d.className = "nominee" + (n.winner ? " winner" : "");
      d.textContent = n.text;
      wrap.appendChild(d);
    });

    resultsEl.appendChild(wrap);
  });
}

/* ------------------ SEARCH FILTER ------------------- */
searchEl.oninput = () => {
  const txt = searchEl.value.toLowerCase();
  const cats = document.querySelectorAll(".category");

  cats.forEach(cat => {
    const full = cat.textContent.toLowerCase();
    cat.style.display = full.includes(txt) ? "" : "none";
  });
};

/* ------------------ HELPERS ------------------- */
function ordinal(n) {
  return (
    n +
    (n % 10 == 1 && n % 100 != 11
      ? "st"
      : n % 10 == 2 && n % 100 != 12
      ? "nd"
      : n % 10 == 3 && n % 100 != 13
      ? "rd"
      : "th")
  );
}

/* ------------------ AUTO LOAD LATEST YEAR ------------------- */
setTimeout(() => {
  document.querySelector(".year-item").click();
}, 600);
</script>

</body>
</html>
        
